let country=window.location.href.split("/")[3];function log(e){return console.log(e),e}function reload(){setTimeout(()=>{window.location.reload(),reload()},18e4)}"Reschedule Appointment"===document.querySelector("#main > div.subTitleBackground > div > div > div")?.innerText&&"Continue"===document.getElementsByName("commit")[0]?.value&&document.getElementsByName("commit")[0].click();try{document.getElementById("confirmed_limit_message")&&(document.getElementById("confirmed_limit_message").checked=!0,document.getElementsByName("commit")[0].click());let r=3e3,u=0,p=window.localStorage.getItem("facilityId"),e=window.localStorage.getItem("user_email"),t=window.localStorage.getItem("remainingAttempts");const g=t?1.7*t:12;let v=window.localStorage.getItem("userId"),y=window.localStorage.getItem("currentAppointmentDate")?new Date(window.localStorage.getItem("currentAppointmentDate")):new Date(864e13),w=y,i=document.createElement("div");if(i.id="progressPopup",document.body.appendChild(i),document.getElementsByTagName("h1")[0]&&document.getElementsByTagName("h1")[0].innerHTML.includes("Maintenance")&&(window.location.href=`https://ais.usvisa-info.com/${country}/niv/users/sign_in`),document.getElementById("appointments_consulate_appointment_facility_id")&&(p?document.getElementById("appointments_consulate_appointment_facility_id").value=p:p=document.getElementById("appointments_consulate_appointment_facility_id").value,document.getElementById("appointments_consulate_appointment_facility_id").onchange=e=>{p=document.getElementById("appointments_consulate_appointment_facility_id").value,window.localStorage.setItem("facilityId",p)}),document.getElementById("confirmed_limit_message")){const m=document.getElementsByTagName("p")[0].innerText,n=m.match(/You have (\d+)/);if(n){const o=parseInt(n[1],10);window.localStorage.setItem("remainingAttempts",o)}document.getElementById("confirmed_limit_message").checked=!0,document.getElementsByName("commit")[0].click()}function updateProgressPopup(e,t,n,o){i.innerHTML=`
      <style>@keyframes blink{
              0%{opacity: 0;}
              50%{opacity: .5;}
              100%{opacity: 1;}
              }
      </style>

    <div style="position: fixed; top: 0; left: 0; background-color: white; padding: 4px; border: 2px solid black; z-index: 100000;width:auto;">
    <div>${e}</div>
      <div style="animation: blink 2s linear infinite;"><b><a href="https://ko-fi.com/brijeshamin" target="_blank">Buy me a coffee and get license key!!</a></b></div>
      <div>Share this code to get license key: <b>${v}</b></div>
      <div><input type="text" id="licenseKey" placeholder="Paste license key here.." autocomplete="off" value="${t}" /></div>
      <div>Just select the locaiton and keep the window open.</div>
      <div>Your appointment will be booked automatically.</div>
      <div>Start Date (optional): <input type="text" id="startDate" placeholder="YYYY-MM-DD" autocomplete="off" value="${n}" /></div>
      <div>End Date (optional): <input type="text" id="endDate" placeholder="YYYY-MM-DD" autocomplete="off" value="${o}" /></div>
      <div><input type="button" id="save" value="Save" onclick="(() => {
        window.localStorage.setItem('startDate', document.getElementById('startDate').value);
        window.localStorage.setItem('endDate', document.getElementById('endDate').value);
      })()" /></div>
      <div><input type="button" id="differentAccount" value="Select different group" onclick="(() => {
        window.localStorage.removeItem('userId');
        window.localStorage.removeItem('currentAppointmentDate');
        window.location.href = window.location.href.split('/niv/')[0] + '/niv/';
      })()" /></div>
    </div>
`}function addMonths(e,t){var n=e.getDate();return e.setMonth(e.getMonth()+ +t),e.getDate()!=n&&e.setDate(0),e}async function getAppointmentTime(t){t=await fetch(`https://ais.usvisa-info.com/${country}/niv/schedule/${v}/appointment/times/${p}.json?date=${t}&appointments[expedite]=false`,{headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-GB,en;q=0.9","sec-ch-ua":'"Chromium";v="130", "Google Chrome";v="130", "Not?A_Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-csrf-token":"1z9xtRY1EmQFvm/cjCfNNqlZOpoDnj3cqd44B5n1C08Zr60UjfkJbRQzhYyNBWnxWOlGErbdKWPHi61JzQopaA==","x-requested-with":"XMLHttpRequest"},referrer:`https://ais.usvisa-info.com/${country}/niv/schedule/${v}/appointment?confirmed_limit_message=1&commit=Continue`,referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"});if(304!==t.status){if(!t.ok)throw new Error("Network response was not ok");var n=t.body.getReader();let e="";for(;;){var{done:o,value:i}=await n.read();if(o)break;e+=(new TextDecoder).decode(i)}return JSON.parse(e)}}async function readStreamToJSON(t,n){if(10===u)try{var o=await fetch(`https://ais.usvisa-info.com/${country}/niv/schedule/${v}/appointment/days/${p}.json?appointments[expedite]=false`,{headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-GB,en-US;q=0.9,en;q=0.8,gu-IN;q=0.7,gu;q=0.6,fr;q=0.5","sec-ch-ua":'"Chromium";v="124", "Google Chrome";v="124", "Not-A.Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-csrf-token":"EQ/ASHgJbVQpIH1ymhKmCsQD9beM/LJ8oiNTQXBM2c0clbldnhKHb+HDv/2MD1WWiQykrnVIVKQtSZ+zoXB3IA==","x-requested-with":"XMLHttpRequest"},referrer:`https://ais.usvisa-info.com/${country}/niv/schedule/${v}/appointment`,referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET",mode:"cors",credentials:"include"});if(304!==o.status){if(!o.ok)throw new Error("Network response was not ok");var i=o.body.getReader();let e="";for(;;){var{done:a,value:l}=await i.read();if(a)break;e+=(new TextDecoder).decode(l)}const s=JSON.parse(e)[0];if(log("First available appointment: "+s?.date),s){var c=getRandomDelay(),d=(r=c,new Date(s.date)),m=(w=d,new Date);let e=addMonths(m,g);log("near date "+e),log("new near date "+(e=t?.getTime()&&n?.getTime()?n:e)),(t?.getTime()&&n?.getTime()&&d.getTime()<y.getTime()&&t.getTime()<=d.getTime()&&d.getTime()<=n.getTime()||d.getTime()<y.getTime()&&d.getTime()<=e.getTime())&&(log("***"+s.date+"***"),window.localStorage.setItem("available_date",s.date),document.getElementById("appointments_consulate_appointment_date").value=s.date,setTimeout(async()=>{document.getElementById("appointments_consulate_appointment_date").click();var e=await getAppointmentTime(s.date),t=(log(e.available_times[0]),window.localStorage.setItem("available_time",e.available_times),document.createElement("option"));t.value=e.available_times[0],t.innerHTML=e.available_times[0],document.getElementById("appointments_consulate_appointment_time").appendChild(t),document.getElementById("appointments_consulate_appointment_time").selectedIndex=1,document.getElementById("appointments_consulate_appointment_time").value=e.available_times[0],log(document.getElementById("appointments_consulate_appointment_time").value),document.getElementById("appointments_submit").disabled=!1,document.getElementById("appointments_submit").click(),setTimeout(()=>{document.querySelector("a.alert").click(),setTimeout(()=>{document.location.href=`https://ais.usvisa-info.com/${country}/niv/account`},5e3)},1e3)},1e3))}else w=y,r=18e4+getRandomDelay(),message=`Looks like appointment window is not open yet.<div>Therefore, increasing check interval to ${r/1e3} seconds.<div>`}}catch(e){console.error("Error reading stream:",e)}}function getRandomDelay(){return 31e3}function validateLicenseKey(e){try{var t=e.slice(15).split("").reverse().join(""),[n,o]=atob(t).split(":");if(!n||!o)throw new Error("Invalid license key format.");if(v===n)return n;throw Error("License key is not valid for this email/user")}catch(e){throw new Error("License key validation failed")}}function runLoop(){let t=`Checking again in ${Math.floor(r/1e3)} seconds`;var e=document.getElementById("licenseKey"),e=(0<e?.value.length?window.localStorage.setItem("licenseKey",e.value):(e=window.localStorage.getItem("licenseKey"))?document.getElementById("licenseKey")&&(document.getElementById("licenseKey").value=e):window.localStorage.setItem("licenseKey",""),window.localStorage.getItem("licenseKey")||""),n=window.localStorage.getItem("startDate");n&&document.getElementById("startDate")&&(document.getElementById("startDate").value=n);let o=n?new Date(n):null;n=window.localStorage.getItem("endDate");n&&document.getElementById("endDate")&&(document.getElementById("endDate").value=n);let i=n?new Date(n):null;try{validateLicenseKey(e),u=10,t+='<br><div style="color: green">License key validation successful</div>'}catch(e){u=1,t+='<br><div style="color: red">Invalid license key</div>'}updateProgressPopup(t,e,window.localStorage.getItem("startDate")||"",window.localStorage.getItem("endDate")||""),setTimeout(async()=>{await readStreamToJSON(o,i),runLoop()},r)}runLoop(),setTimeout(()=>{window.location.href=`https://ais.usvisa-info.com/${country}/niv/schedule/${v}/appointment`},6e5)}catch(e){reload()}
